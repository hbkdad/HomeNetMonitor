name: Build & Deploy HomeNetMonitor

on:
  push:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v3

      - name: ðŸ› ï¸ Install build tools
        run: |
          sudo apt update
          sudo apt install -y dpkg-dev jq curl

      - name: ðŸ“¦ Build the .deb package
        run: |
          chmod +x ./install-scripts/wizard-installer.sh
          mkdir -p ./deb-build/home-net-monitor/DEBIAN
          echo "Package: home-net-monitor
Version: 1.1.0
Section: utils
Priority: optional
Architecture: all
Maintainer: hbkdad
Description: HomeNetMonitor Network Tool
" > ./deb-build/home-net-monitor/DEBIAN/control

          cp -r ./agent ./backend ./frontend ./install-scripts ./deb-build/home-net-monitor/usr/local/home-net-monitor/
          dpkg-deb --build ./deb-build/home-net-monitor

      - name: ðŸ“¤ Upload Artifact to GitHub
        uses: actions/upload-artifact@v3
        with:
          name: home-net-monitor-deb
          path: ./deb-build/home-net-monitor.deb

      - name: ðŸ§¾ Create version.txt
        run: echo "1.1.0" > version.txt

      - name: ðŸš€ Publish to GitHub Releases
        uses: softprops/action-gh-release@v1
        with:
          name: Release v1.1.0
          tag_name: v1.1.0
          files: |
            deb-build/home-net-monitor.deb
            version.txt
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
name: Build and Push HomeNetMonitor DEB

on:
  push:
    branches:
      - master

jobs:
  build-and-push:
    runs-on: ubuntu-latest

    steps:
      - name: âœ… Checkout Repository
        uses: actions/checkout@v3

      - name: ðŸ“¦ Build .deb Package
        run: |
          mkdir -p deb-build-output
          cp -r * deb-build-output/
          cd deb-build-output
          dpkg-deb --build home-net-monitor
          cp home-net-monitor.deb ..

      - name: ðŸ“¤ Upload .deb as Artifact
        uses: actions/upload-artifact@v3
        with:
          name: home-net-monitor
          path: home-net-monitor.deb
